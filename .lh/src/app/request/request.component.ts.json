{
    "sourceFile": "src/app/request/request.component.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1733043843200,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1733043852940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -178,9 +178,9 @@\n     if (this.user.jobPosition === 'POS Business Officer'){\r\n       this.apiService.getAllPosBusinessRequest().subscribe(\r\n         posNewRequest => {\r\n           this.serialRequest = posNewRequest;\r\n-          console.log(posNewRequest)\r\n+          console.log('S')\r\n         }\r\n       )\r\n     }\r\n     else {\r\n"
                },
                {
                    "date": 1733043928803,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,8 +69,9 @@\n   serialDialog(posRequest: any): void {\r\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n+      \r\n       data: {\r\n         status: posRequest.status,\r\n         title: 'Serial Number Details',\r\n         tabs: [\r\n@@ -178,9 +179,9 @@\n     if (this.user.jobPosition === 'POS Business Officer'){\r\n       this.apiService.getAllPosBusinessRequest().subscribe(\r\n         posNewRequest => {\r\n           this.serialRequest = posNewRequest;\r\n-          console.log('S')\r\n+          console.log('Serial Request:', this.serialRequest);\r\n         }\r\n       )\r\n     }\r\n     else {\r\n"
                },
                {
                    "date": 1733043940974,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,8 +69,9 @@\n   serialDialog(posRequest: any): void {\r\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n+      height: '500px',\r\n       \r\n       data: {\r\n         status: posRequest.status,\r\n         title: 'Serial Number Details',\r\n"
                },
                {
                    "date": 1733043958989,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,11 @@\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n       height: '500px',\r\n-      \r\n+      if (us) {\r\n+        \r\n+      }\r\n       data: {\r\n         status: posRequest.status,\r\n         title: 'Serial Number Details',\r\n         tabs: [\r\n"
                },
                {
                    "date": 1733043964303,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n       height: '500px',\r\n-      if (us) {\r\n+      if (user.jobPosition === 'POS Business Officer'){ {\r\n         \r\n       }\r\n       data: {\r\n         status: posRequest.status,\r\n"
                },
                {
                    "date": 1733043969385,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n       height: '500px',\r\n-      if (user.jobPosition === 'POS Business Officer'){ {\r\n+      if (thuser.jobPosition === 'POS Business Officer'){ {\r\n         \r\n       }\r\n       data: {\r\n         status: posRequest.status,\r\n"
                },
                {
                    "date": 1733043986519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n       height: '500px',\r\n-      if (thuser.jobPosition === 'POS Business Officer'){ {\r\n+      if (this.user.jobPosition === 'POS Business Officer'){{\r\n         \r\n       }\r\n       data: {\r\n         status: posRequest.status,\r\n"
                },
                {
                    "date": 1733043993749,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -72,9 +72,9 @@\n       width: '750px',\r\n       height: '500px',\r\n       if (this.user.jobPosition === 'POS Business Officer'){\r\n         \r\n-      } \r\n+      } e\r\n       data: {\r\n         status: posRequest.status,\r\n         title: 'Serial Number Details',\r\n         tabs: [\r\n"
                },
                {
                    "date": 1733044028143,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n     let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n     this.dialog.open(ModalComponent, {\r\n       width: '750px',\r\n       height: '500px',\r\n-      if (zz) {\r\n+      if (zzz) {\r\n         \r\n       }\r\n       data: {\r\n         status: posRequest.status,\r\n"
                }
            ],
            "date": 1733043843200,
            "name": "Commit-0",
            "content": "import { DatePipe } from '@angular/common';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { ChangeDetectorRef, Component, Input, OnInit } from '@angular/core';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { Router } from '@angular/router';\r\nimport { catchError, forkJoin, from, of, throwError } from 'rxjs';\r\nimport { ModalComponent } from '../modal/modal.component';\r\nimport { AppService } from '../app.service';\r\nimport { MerchantsComponent } from '../merchants/merchants.component';\r\nimport { ApiDetailsService } from '../api-details.service';\r\nimport { PosRequest } from '../posrequest';\r\nimport { SerialRequest } from '../serial-number';\r\n\r\n@Component({\r\n  selector: 'app-request',\r\n  templateUrl: './request.component.html',\r\n  styleUrls: ['./request.component.css'],\r\n})\r\nexport class RequestComponent implements OnInit {\r\n  @Input() n: number = 14; // The number of Items in a page\r\n  currentPage = 1;\r\n  posRequests: PosRequest[] = [];\r\n  serialRequest: SerialRequest [] = [];\r\n  selectedRequest: any;\r\n  selectedStatus: string = '';\r\n  merchant: any;\r\n  user: any;\r\n  officerName: string = '';\r\n  viewRequest = false;\r\n\r\n  mergedData: { request: any; merchant: any }[] = [];\r\n  filteredData: { request: any; merchant: any }[] = [];\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private router: Router,\r\n    private datePipe: DatePipe,\r\n    private cdr: ChangeDetectorRef,\r\n    public dialog: MatDialog,\r\n    private sharedService: AppService,\r\n    private apiService: ApiDetailsService\r\n  ) {}\r\n\r\n  // filterRequests(status: string) {\r\n  //   if (status = ''){\r\n  //     this.filteredData = this.mergedData;\r\n  //     this.selectedStatus = 'All'\r\n  //     console.log(\"No Filter\" + this.filteredData)\r\n  //   }\r\n  //   else{\r\n  //     this.filteredData = this.mergedData.filter(\r\n  //       data => data.request.status === status\r\n  //     )\r\n  //     this.selectedStatus = status;\r\n  //     console.log(status+\": \" + this.filteredData)\r\n  //   }\r\n  // }\r\n\r\n  //Function to determine if the page is on the home Page\r\n  get defineHomePage(): boolean {\r\n    return this.router.url === '/dashboard';\r\n  }\r\n\r\n  convertDate(dateString: string): string {\r\n    const date = new Date(dateString);\r\n    return this.datePipe.transform(date, 'yyyy-MM-dd') || '';\r\n  }\r\n\r\n  serialDialog(posRequest: any): void {\r\n    let serialNumbers = posRequest.Pos_SerialNumber.join('\\n');\r\n    this.dialog.open(ModalComponent, {\r\n      width: '750px',\r\n      data: {\r\n        status: posRequest.status,\r\n        title: 'Serial Number Details',\r\n        tabs: [\r\n          {\r\n            items: [\r\n              { label: 'Request ID', value: posRequest.Pos_RequestId},\r\n              { label: 'Requested Pos', value: posRequest.NumberOfPos},\r\n              { label: 'Serial Numbers', value: serialNumbers},\r\n              { label: 'Account Type', value: posRequest.Pos_Accounts},\r\n              { label: 'PTSP', value: posRequest.PTSP},\r\n              { label: 'POS Model Type', value: posRequest.Pos_Model},\r\n              { label: 'POS Processor Type', value: posRequest.Pos_Processor},\r\n              { label: 'Status', value: posRequest.status}\r\n            ]\r\n          }\r\n        ]\r\n    }\r\n  })\r\n  }\r\n\r\n  openDialog(posRequest: any, merchant: any): void {\r\n    const dialogRef = this.dialog.open(ModalComponent, {\r\n      width: '750px',\r\n      data: {\r\n        status: posRequest.status,\r\n        title: 'Details of ' + posRequest.RequestId,\r\n        user: this.user.jobPosition,\r\n        officer: posRequest.officer_name,\r\n        name: this.user.user.firstname + ' ' + this.user.user.surname,\r\n        tabs: [\r\n          {\r\n            label: 'Request Details',\r\n            items: [\r\n              { label: 'Request ID:', value: posRequest.RequestId },\r\n              {\r\n                label: 'Date of Request:',\r\n                value: this.convertDate(posRequest.createdAt),\r\n              },\r\n              { label: 'Bank Account:', value: posRequest.bank },\r\n              { label: 'Request Status:', value: posRequest.status },\r\n              { label: 'Notes:', value: posRequest.Notes },\r\n              { label: 'Officer In Charge', value: posRequest.officer_name },\r\n            ],\r\n          },\r\n          {\r\n            label: 'Business Details',\r\n            items: [\r\n              { label: 'Business Name', value: merchant.Merchant_Trade_Name },\r\n              { label: 'Business Type', value: merchant.Business_type },\r\n              { label: 'Business Location', value: merchant.Business_location },\r\n              {\r\n                label: 'Contact Name',\r\n                value: merchant.Name_of_Primary_Contact,\r\n              },\r\n              { label: 'Phone Number', value: merchant.office_No },\r\n              { label: 'Contact Location', value: merchant.office_email },\r\n              { label: 'Contact Email', value: merchant.office_email },\r\n            ],\r\n          },\r\n          {\r\n            label: 'POS Terminal Contact',\r\n            items: [\r\n              {\r\n                label: 'Location of Terminal',\r\n                value: posRequest.location_of_terminal,\r\n              },\r\n              { label: 'Name', value: posRequest.contact_person },\r\n              { label: 'Phone Number', value: posRequest.contact_mobile_no },\r\n              // {label: 'Image', value: posRequest.images}\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n    });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.user = this.sharedService.getUser();\r\n    this.officerName = this.user.user.firstname + ' ' + this.user.user.surname;\r\n    this.requestPage();\r\n\r\n    this.apiService.refresh$.subscribe(() => {\r\n      this.requestPage();\r\n    })\r\n  }\r\n\r\n  nextPage(): void {\r\n      this.currentPage++;\r\n  }\r\n\r\n  previousPage(): void {\r\n    if (this.currentPage > 1) {\r\n      this.currentPage--;\r\n    }\r\n  }\r\n\r\n  setStatus(status: string){\r\n    this.selectedStatus = status;\r\n    console.log(this.selectedStatus)\r\n    this.requestPage();\r\n  }\r\n\r\n  requestPage(){\r\n    // console.log(this.user.jobPosition)\r\n    if (this.user.jobPosition === 'POS Business Officer'){\r\n      this.apiService.getAllPosBusinessRequest().subscribe(\r\n        posNewRequest => {\r\n          this.serialRequest = posNewRequest;\r\n          console.log(posNewRequest)\r\n        }\r\n      )\r\n    }\r\n    else {\r\n      this.apiService.getRequest().subscribe(\r\n        (posRequests) => {\r\n          if (this.selectedStatus){\r\n            posRequests = posRequests.filter(\r\n              (status:any) => status.status === this.selectedStatus\r\n            );\r\n          }\r\n  \r\n          if (this.user.jobPosition === 'Account Officer') {\r\n            posRequests = posRequests.filter(\r\n              (request: any) => request.officer_name === this.officerName\r\n            );\r\n          }\r\n          \r\n          posRequests = posRequests.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\r\n  \r\n          this.posRequests = posRequests;\r\n          console.log(this.posRequests);\r\n  \r\n          const merchantRequests = this.posRequests.map((posRequest) => {\r\n            const merchantID = posRequest.MerchantID;\r\n            if (typeof merchantID === 'string' && merchantID !== 'string') {\r\n              return this.apiService.getMerchantById(merchantID);\r\n            } else {\r\n              console.error('Invalid merchantID:', merchantID);\r\n              return of(null); // Return an Observable of null if merchantID is invalid\r\n            }\r\n          });\r\n  \r\n          forkJoin(merchantRequests).subscribe(\r\n            (merchants) => {\r\n              this.mergedData = this.posRequests.map((request, index) => ({\r\n                request: request,\r\n                merchant: merchants[index],\r\n              }));\r\n            },\r\n            (error) => {\r\n              console.error(error);\r\n            }\r\n          );\r\n        },\r\n        (error) => {\r\n          console.error(error);\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n"
        }
    ]
}